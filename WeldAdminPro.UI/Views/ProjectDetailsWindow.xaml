<Window x:Class="WeldAdminPro.UI.Views.ProjectDetailsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Project Details"
        Width="620"
        Height="820"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

	<ScrollViewer VerticalScrollBarVisibility="Auto">
		<Grid Margin="20">

			<!-- ================= MAIN LAYOUT ================= -->
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<!-- Header -->
				<RowDefinition Height="Auto"/>
				<!-- Project details -->
				<RowDefinition Height="Auto"/>
				<!-- Buttons -->
				<RowDefinition Height="Auto"/>
				<!-- Financial Summary -->
				<RowDefinition Height="Auto"/>
				<!-- Issue Stock -->
				<RowDefinition Height="Auto"/>
				<!-- Issued History -->
				<RowDefinition Height="Auto"/>
				<!-- Return Stock -->
				<RowDefinition Height="Auto"/>
				<!-- Stock Summary -->
			</Grid.RowDefinitions>

			<!-- ================= HEADER ================= -->
			<Grid Grid.Row="0" Margin="0,0,0,15">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="120"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="120"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<TextBlock Text="Job Number" FontWeight="Bold"/>
				<TextBox Grid.Column="1"
                         Text="{Binding Project.JobNumber}"
                         IsReadOnly="True"
                         Background="#EEE"/>

				<TextBlock Grid.Column="2"
                           Text="Status"
                           FontWeight="Bold"/>
				<ComboBox Grid.Column="3"
                          ItemsSource="{Binding Statuses}"
                          SelectedItem="{Binding Project.Status}"
                          Height="26"
                          IsEnabled="{Binding IsEditable}"/>
			</Grid>

			<!-- ================= PROJECT DETAILS ================= -->
			<Grid Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="120"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="20"/>
					<ColumnDefinition Width="120"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>

				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<TextBlock Grid.Row="0" Text="Project Name"/>
				<TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="4"
                         Text="{Binding Project.ProjectName}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="1" Text="Client" Margin="0,6,0,0"/>
				<TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4"
                         Margin="0,6,0,0"
                         Text="{Binding Project.Client}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="2" Text="Client Rep" Margin="0,6,0,0"/>
				<TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="4"
                         Margin="0,6,0,0"
                         Text="{Binding Project.ClientRepresentative}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="3" Text="Quote #" Margin="0,6,0,0"/>
				<TextBox Grid.Row="3" Grid.Column="1"
                         Margin="0,6,0,0"
                         Text="{Binding Project.QuoteNumber}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="3" Grid.Column="3" Text="Order #" Margin="0,6,0,0"/>
				<TextBox Grid.Row="3" Grid.Column="4"
                         Margin="0,6,0,0"
                         Text="{Binding Project.OrderNumber}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="4" Text="Budget (R)" Margin="0,6,0,0"/>
				<TextBox Grid.Row="4" Grid.Column="1"
                         Margin="0,6,0,0"
                         Text="{Binding Project.Budget}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="5" Text="Material" Margin="0,6,0,0"/>
				<TextBox Grid.Row="5" Grid.Column="1"
                         Margin="0,6,0,0"
                         Text="{Binding Project.Material}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="5" Grid.Column="3" Text="Assigned To" Margin="0,6,0,0"/>
				<TextBox Grid.Row="5" Grid.Column="4"
                         Margin="0,6,0,0"
                         Text="{Binding Project.AssignedTo}"
                         IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="6" Text="Start Date" Margin="0,6,0,0"/>
				<DatePicker Grid.Row="6" Grid.Column="1"
                            Margin="0,6,0,0"
                            SelectedDate="{Binding Project.StartDate}"
                            IsEnabled="{Binding IsEditable}"/>

				<TextBlock Grid.Row="6" Grid.Column="3" Text="End Date" Margin="0,6,0,0"/>
				<DatePicker Grid.Row="6" Grid.Column="4"
                            Margin="0,6,0,0"
                            SelectedDate="{Binding Project.EndDate}"
                            IsEnabled="{Binding IsEditable}"/>

				<CheckBox Grid.Row="7"
                          Content="Invoiced"
                          Margin="0,10,0,0"
                          IsChecked="{Binding Project.IsInvoiced}"
                          IsEnabled="{Binding IsEditable}"/>

				<TextBox Grid.Row="7" Grid.Column="4"
                         Margin="0,10,0,0"
                         Text="{Binding Project.InvoiceNumber}"
                         IsEnabled="{Binding IsEditable}"/>
			</Grid>

			<!-- ================= SAVE / CANCEL ================= -->
			<StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,20,0,0">
				<Button Content="Save"
                        Width="100"
                        Margin="0,0,10,0"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding CanSave}"/>
				<Button Content="Cancel"
                        Width="100"
                        Command="{Binding CancelCommand}"/>
			</StackPanel>

			<!-- ================= FINANCIAL SUMMARY ================= -->
			<GroupBox Grid.Row="3"
                      Header="Financial Summary"
                      Margin="0,20,0,0">
				<Grid Margin="10">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="160"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>

					<Grid.RowDefinitions>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
					</Grid.RowDefinitions>

					<TextBlock Text="Budget" FontWeight="Bold"/>
					<TextBlock Grid.Column="1"
                               Text="{Binding Project.Budget, StringFormat=R {0:N2}}"/>

					<TextBlock Grid.Row="1" Text="Actual Cost" Margin="0,6,0,0"/>
					<TextBlock Grid.Row="1" Grid.Column="1"
                               Margin="0,6,0,0"
                               Text="{Binding Project.ActualCost, StringFormat=R {0:N2}}"/>

					<TextBlock Grid.Row="2" Text="Committed Cost" Margin="0,6,0,0"/>
					<TextBlock Grid.Row="2" Grid.Column="1"
                               Margin="0,6,0,0"
                               Text="{Binding Project.CommittedCost, StringFormat=R {0:N2}}"/>

					<TextBlock Grid.Row="3" Text="Variance" Margin="0,6,0,0"/>
					<TextBlock Grid.Row="3" Grid.Column="1"
                               Margin="0,6,0,0"
                               FontWeight="Bold"
                               Text="{Binding Variance, StringFormat=R {0:N2}}"/>

					<TextBlock Grid.Row="4" Text="Margin %" Margin="0,6,0,0"/>
					<TextBlock Grid.Row="4" Grid.Column="1"
                               Margin="0,6,0,0"
                               FontWeight="Bold"
                               Text="{Binding MarginPercentage, StringFormat={}{0:N2}%}"/>
				</Grid>
			</GroupBox>

			<!-- ================= ISSUE STOCK ================= -->
			<GroupBox Grid.Row="4"
                      Header="Issue Stock to Project"
                      Margin="0,20,0,0"
                      IsEnabled="{Binding IsEditable}">
				<Grid Margin="10">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="120"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
					</Grid.RowDefinitions>

					<TextBlock Text="Stock Item"/>
					<ComboBox Grid.Column="1"
                              ItemsSource="{Binding StockItems}"
                              SelectedItem="{Binding SelectedStockItem}"
                              DisplayMemberPath="Description"/>

					<TextBlock Grid.Row="1" Text="Quantity" Margin="0,6,0,0"/>
					<TextBox Grid.Row="1" Grid.Column="1"
                             Margin="0,6,0,0"
                             Text="{Binding IssueQuantity}"/>

					<TextBlock Grid.Row="2" Grid.Column="1"
                               Foreground="Gray"
                               Text="{Binding AvailableQuantity, StringFormat=Available: {0}}"/>

					<TextBlock Grid.Row="3" Text="Issued By" Margin="0,6,0,0"/>
					<TextBox Grid.Row="3" Grid.Column="1"
                             Margin="0,6,0,0"
                             Text="{Binding IssuedBy}"/>

					<Button Grid.Row="3" Grid.Column="1"
                            Content="Issue Stock"
                            Width="120"
                            HorizontalAlignment="Right"
                            Margin="0,10,0,0"
                            Command="{Binding IssueStockCommand}"
                            IsEnabled="{Binding CanIssueStock}"/>
				</Grid>
			</GroupBox>

			<!-- ================= ISSUED HISTORY ================= -->
			<GroupBox Grid.Row="5"
                      Header="Issued Stock History"
                      Margin="0,20,0,0">
				<DataGrid ItemsSource="{Binding IssuedStockHistory}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserAddRows="False">
					<DataGrid.Columns>
						<DataGridTextColumn Header="Date"
                                            Binding="{Binding IssuedOn, StringFormat=\{0:yyyy-MM-dd HH:mm\}}"
                                            Width="150"/>
						<DataGridTextColumn Header="Item"
                                            Binding="{Binding Notes}"
                                            Width="*"/>
						<DataGridTextColumn Header="Qty"
                                            Binding="{Binding Quantity}"
                                            Width="80"/>
						<DataGridTextColumn Header="By"
                                            Binding="{Binding IssuedBy}"
                                            Width="120"/>
					</DataGrid.Columns>
				</DataGrid>
			</GroupBox>

			<!-- ================= RETURN STOCK ================= -->
			<GroupBox Grid.Row="6"
                      Header="Return Stock"
                      Margin="0,20,0,0"
                      IsEnabled="{Binding IsEditable}">
				<Grid Margin="10">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="120"/>
						<ColumnDefinition Width="*"/>
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
						<RowDefinition/>
					</Grid.RowDefinitions>

					<TextBlock Text="Issued Item"/>
					<ComboBox Grid.Column="1"
                              ItemsSource="{Binding ReturnableIssuedItems}"
                              SelectedItem="{Binding SelectedIssuedUsage}"
                              DisplayMemberPath="Notes"/>

					<TextBlock Grid.Row="1" Text="Return Qty" Margin="0,6,0,0"/>
					<TextBox Grid.Row="1" Grid.Column="1"
                             Margin="0,6,0,0"
                             Text="{Binding ReturnQuantity}"/>

					<TextBlock Grid.Row="2" Grid.Column="1"
                               Foreground="Gray"
                               Text="{Binding RemainingIssuedBalance, StringFormat=Remaining issued: {0}}"/>

					<Button Grid.Row="3" Grid.Column="1"
                            Content="Return Stock"
                            Width="120"
                            HorizontalAlignment="Right"
                            Margin="0,10,0,0"
                            Command="{Binding ReturnStockCommand}"
                            IsEnabled="{Binding CanReturnStock}"/>
				</Grid>
			</GroupBox>

			<!-- ================= STOCK SUMMARY ================= -->
			<GroupBox Grid.Row="7"
                      Header="Project Stock Summary"
                      Margin="0,20,0,0">
				<StackPanel>

					<DataGrid ItemsSource="{Binding ProjectStockSummary}"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              CanUserAddRows="False"
                              Margin="0,0,0,8">

						<DataGrid.RowStyle>
							<Style TargetType="DataGridRow">
								<Style.Triggers>
									<DataTrigger Binding="{Binding HasNegativeNetUsage}" Value="True">
										<Setter Property="Background" Value="#FFF4CCCC"/>
									</DataTrigger>
								</Style.Triggers>
							</Style>
						</DataGrid.RowStyle>

						<DataGrid.Columns>
							<DataGridTextColumn Header="Code" Binding="{Binding ItemCode}" Width="120"/>
							<DataGridTextColumn Header="Item" Binding="{Binding Description}" Width="*"/>
							<DataGridTextColumn Header="Issued" Binding="{Binding IssuedQuantity}" Width="90"/>
							<DataGridTextColumn Header="Returned" Binding="{Binding ReturnedQuantity}" Width="90"/>
							<DataGridTextColumn Header="Net Used" Binding="{Binding NetQuantity}" Width="90"/>
							<DataGridTextColumn Header="Unit" Binding="{Binding Unit}" Width="80"/>
						</DataGrid.Columns>
					</DataGrid>

					<Grid Margin="5,0,5,5">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="90"/>
							<ColumnDefinition Width="90"/>
							<ColumnDefinition Width="90"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="TOTALS"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center"/>

						<TextBlock Grid.Column="1"
                                   Text="{Binding TotalIssued}"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Right"/>

						<TextBlock Grid.Column="2"
                                   Text="{Binding TotalReturned}"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Right"/>

						<TextBlock Grid.Column="3"
                                   Text="{Binding TotalNetUsed}"
                                   FontWeight="Bold"
                                   HorizontalAlignment="Right"/>

						<Button Grid.Column="4"
                                Content="Export Totals"
                                Width="100"
                                Margin="10,0,0,0"
                                Command="{Binding ExportStockSummaryCommand}"/>
					</Grid>

				</StackPanel>
			</GroupBox>

		</Grid>
	</ScrollViewer>
</Window>
