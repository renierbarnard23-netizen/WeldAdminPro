<UserControl x:Class="WeldAdminPro.UI.Views.StockView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:WeldAdminPro.Core.Models;assembly=WeldAdminPro.Core">

	<UserControl.Resources>

		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

		<Style x:Key="FilterButtonStyle" TargetType="Button">
			<Setter Property="Padding" Value="6,2"/>
			<Setter Property="Margin" Value="0,0,6,0"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="BorderBrush" Value="#FFB0B0B0"/>
			<Setter Property="Background" Value="#FFF5F5F5"/>
		</Style>

	</UserControl.Resources>

	<Grid Margin="15">

		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- ACTION BUTTONS -->
		<WrapPanel Grid.Row="0" Margin="0,0,0,12">
			<Button Content="New Stock Item" Width="140" Margin="4" Command="{Binding NewItemCommand}" />
			<Button Content="Edit Stock Item" Width="140" Margin="4" Command="{Binding EditItemCommand}" />
			<Button Content="Manage Categories" Width="170" Margin="4" Click="ManageCategories_Click" />
			<Button Content="Stock IN" Width="110" Margin="4" Command="{Binding StockInCommand}" />
			<Button Content="Stock OUT" Width="110" Margin="4" Command="{Binding StockOutCommand}" />
			<Button Content="Transaction History" Width="170" Margin="4" Command="{Binding ViewHistoryCommand}" />
			<Button Content="Export Warnings" Width="160" Margin="12,4,4,4"
                    Command="{Binding ExportWarningsCommand}"
                    IsEnabled="{Binding HasStockWarnings}" />
		</WrapPanel>

		<!-- CATEGORY -->
		<StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,12">
			<TextBlock Text="Category:" VerticalAlignment="Center" Margin="0,0,8,0"/>
			<ComboBox Width="240"
                      ItemsSource="{Binding Categories}"
                      SelectedItem="{Binding SelectedCategory}"
                      DisplayMemberPath="Name"/>
		</StackPanel>

		<!-- FILTER BUTTONS -->
		<StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,12">
			<Button Content="All" Width="80"
                    Style="{StaticResource FilterButtonStyle}"
                    Command="{Binding ShowAllCommand}"/>
			<Button Content="🟡 Low" Width="90"
                    Style="{StaticResource FilterButtonStyle}"
                    Command="{Binding ShowLowCommand}"/>
			<Button Content="🔴 Out" Width="90"
                    Style="{StaticResource FilterButtonStyle}"
                    Command="{Binding ShowOutCommand}"/>
		</StackPanel>

		<!-- WARNING BANNER -->
		<Border Grid.Row="3"
                Margin="0,0,0,12"
                Padding="8"
                Background="#FFFFF2CC"
                BorderBrush="#FFCC9900"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="{Binding HasStockWarnings, Converter={StaticResource BooleanToVisibilityConverter}}">

			<StackPanel Orientation="Horizontal">
				<TextBlock Text="⚠ Stock warnings:" FontWeight="Bold" Margin="0,0,15,0"/>
				<TextBlock Text="{Binding OutOfStockCount, StringFormat=🔴 {0} out of stock}" Margin="0,0,15,0"/>
				<TextBlock Text="{Binding LowStockCount, StringFormat=🟡 {0} low stock}"/>
			</StackPanel>
		</Border>

		<!-- FINANCIAL SUMMARY -->
		<Border Grid.Row="4"
                Margin="0,0,0,15"
                Padding="12"
                Background="#FFEFF6FF"
                BorderBrush="#FF4A90E2"
                BorderThickness="1"
                CornerRadius="6">

			<StackPanel>
				<TextBlock FontSize="15"
                           FontWeight="Bold"
                           Text="📊 Inventory Financial Summary"
                           Margin="0,0,0,10"/>

				<UniformGrid Columns="2" Rows="2">

					<TextBlock Text="{Binding TotalInventoryValue, StringFormat=💰 Total Inventory Value: R {0:N2}}"
                               FontWeight="SemiBold"/>

					<TextBlock Text="{Binding TotalUnitsInStock, StringFormat=📦 Total Units: {0}}"
                               FontWeight="SemiBold"/>

					<TextBlock Text="{Binding TotalLowStockValue, StringFormat=🟡 Low Stock Value Risk: R {0:N2}}"/>

					<TextBlock Text="{Binding TotalOutOfStockValue, StringFormat=🔴 Out of Stock Value: R {0:N2}}"/>

				</UniformGrid>
			</StackPanel>
		</Border>

		<!-- DATA GRID -->
		<DataGrid Grid.Row="5"
                  ItemsSource="{Binding Items}"
                  SelectedItem="{Binding SelectedItem}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  RowHeight="28">

			<!-- ✅ FIXED ROW COLOR TRIGGERS -->
			<DataGrid.RowStyle>
				<Style TargetType="DataGridRow">
					<Style.Triggers>

						<!-- 🔴 OUT OF STOCK -->
						<DataTrigger Binding="{Binding Status}"
                                     Value="{x:Static models:StockStatus.Out}">
							<Setter Property="Background" Value="#FFF2CCCC"/>
							<Setter Property="Foreground" Value="DarkRed"/>
							<Setter Property="FontWeight" Value="Bold"/>
						</DataTrigger>

						<!-- 🟡 LOW STOCK -->
						<DataTrigger Binding="{Binding Status}"
                                     Value="{x:Static models:StockStatus.Low}">
							<Setter Property="Background" Value="#FFFFF2CC"/>
							<Setter Property="Foreground" Value="DarkGoldenrod"/>
						</DataTrigger>

					</Style.Triggers>
				</Style>
			</DataGrid.RowStyle>

			<DataGrid.Columns>

				<DataGridTextColumn Header="Item Code"
                                    Binding="{Binding ItemCode}"
                                    Width="120"/>

				<DataGridTextColumn Header="Description"
                                    Binding="{Binding Description}"
                                    Width="*"/>

				<DataGridTextColumn Header="Quantity"
                                    Binding="{Binding Quantity}"
                                    Width="90"/>

				<DataGridTextColumn Header="Unit Cost (R)"
                                    Binding="{Binding AverageUnitCost, StringFormat=N2}"
                                    Width="120"/>

				<DataGridTextColumn Header="Total Value (R)"
                                    Binding="{Binding TotalStockValue, StringFormat=N2}"
                                    Width="140"/>

				<DataGridTextColumn Header="Unit"
                                    Binding="{Binding Unit}"
                                    Width="80"/>

				<DataGridTextColumn Header="Category"
                                    Binding="{Binding Category}"
                                    Width="140"/>

			</DataGrid.Columns>

		</DataGrid>

	</Grid>
</UserControl>
